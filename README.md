# ゴルフフィッティングWebアプリ

このプロジェクトは、AIを活用したゴルフクラブフィッティングWebアプリケーションです。ユーザーの身体特性やスイングデータに基づいて、最適なゴルフクラブをレコメンドします。

## 機能

- ユーザープロファイル入力（身長、体重、年齢、性別など）
- スイングデータ分析（ヘッドスピード、ボールスピード、打ち出し角度など）
- AIベースのクラブレコメンデーション
- 価格比較機能
- フィッティング解析レポート

## 自動化機能

### データ収集
- 毎週月曜日の午前3時に自動的にゴルフクラブ情報をスクレイピング
- スクレイピング完了後、Slackに通知
- 収集したデータは`data/golf_clubs.json`に保存

### バックアップ
- 毎日午前2時にデータベースのバックアップを自動実行
- バックアップ完了後、Slackに通知
- バックアップファイルは`backups/`ディレクトリに保存
- 最新10件のバックアップ履歴を`backups/backup_history.json`に記録

### スケジューラの起動方法
```bash
python scripts/scheduler.py
```

## 技術スタック

- バックエンド: FastAPI
- フロントエンド: Streamlit
- 機械学習: scikit-learn
- データ処理: pandas, numpy
- 可視化: matplotlib, seaborn

## セットアップ手順

1. リポジトリのクローン
```bash
git clone [repository-url]
cd golf-fitting-app
```

2. 仮想環境の作成と有効化
```bash
python -m venv venv
source venv/bin/activate  # Windows: venv\Scripts\activate
```

3. 依存パッケージのインストール
```bash
pip install -r requirements.txt
```

4. バックエンドサーバーの起動
```bash
uvicorn app:app --reload
```

5. フロントエンドの起動（別のターミナルで）
```bash
streamlit run frontend.py
```

## 使用方法

### 基本的な使用方法

1. ブラウザで `http://localhost:8501` にアクセス
2. サイドバーでユーザー情報を入力
3. 「最適なクラブセットを検索」ボタンをクリック
4. レコメンデーション結果を確認

### 詳細な使用方法

#### ユーザープロファイル入力
- 必須項目：
  - 身長（cm）
  - 体重（kg）
  - 年齢
  - 性別
  - 利き手
- オプション項目：
  - スイングスピード
  - プレイ頻度
  - 現在のハンディキャップ

#### スイングデータ分析
- 入力可能なデータ：
  - ヘッドスピード
  - ボールスピード
  - 打ち出し角度
  - スピン量
  - キャリー距離

#### レコメンデーション結果
- 表示される情報：
  - 推奨クラブセット
  - 各クラブの詳細仕様
  - 価格比較
  - 適合度スコア

## APIエンドポイント

### ユーザー関連
- `POST /users/` - 新規ユーザー登録
- `GET /users/me` - 現在のユーザー情報取得
- `PUT /users/me` - 現在のユーザー情報更新
- `GET /users/{user_id}` - 特定のユーザー情報取得

### クラブ関連
- `GET /clubs/` - クラブ一覧取得
- `GET /clubs/{club_id}` - 特定のクラブ情報取得
- `POST /clubs/recommend` - クラブレコメンデーション
- `GET /clubs/search` - クラブ検索

### 認証関連
- `POST /auth/login` - ログイン
- `POST /auth/logout` - ログアウト
- `POST /auth/refresh` - トークンリフレッシュ

## データベーススキーマ

### ユーザーテーブル
- id: プライマリーキー
- email: メールアドレス
- hashed_password: ハッシュ化されたパスワード
- full_name: 氏名
- created_at: 作成日時
- updated_at: 更新日時

### クラブテーブル
- id: プライマリーキー
- name: クラブ名
- brand: ブランド名
- category: カテゴリ（ドライバー、アイアン等）
- loft: ロフト角
- length: 長さ
- lie: ライ角
- price: 価格
- created_at: 作成日時
- updated_at: 更新日時

## 開発ガイドライン

### コード規約
- PEP 8に準拠
- 型ヒントの使用
- ドキュメント文字列の記述

### テスト
- pytestを使用
- 単体テストと統合テストの実装
- カバレッジレポートの生成

### デプロイメント
- Dockerコンテナ化
- CI/CDパイプラインの設定
- 環境変数の管理

## データベースの初期化とマイグレーション

### 初期設定
1. データベースの作成
```bash
python scripts/init_db.py
```

2. マイグレーションの実行
```bash
alembic upgrade head
```

### 環境変数の設定

以下の環境変数を設定する必要があります：

1. Google Analytics
   - `GA_TRACKING_ID`: Google AnalyticsのトラッキングID

2. Hotjar
   - `HOTJAR_ID`: HotjarのサイトID

3. データベース
   - `DATABASE_URL`: データベースの接続URL

4. 認証
   - `SECRET_KEY`: JWTトークンの署名に使用するシークレットキー
   - `ALGORITHM`: JWTトークンの署名アルゴリズム
   - `ACCESS_TOKEN_EXPIRE_MINUTES`: アクセストークンの有効期限（分）

5. アプリケーション設定
   - `APP_NAME`: アプリケーション名
   - `APP_VERSION`: アプリケーションのバージョン
   - `DEBUG`: デバッグモードの有効/無効

環境変数は`.env`ファイルに設定するか、システムの環境変数として設定してください。

## バックアップとリストア

### バックアップの作成
```bash
python scripts/backup_database.py
```

### リストア
```bash
python scripts/restore_database.py --backup-file backup_file.sql
```

## トラブルシューティング

### よくある問題と解決方法

1. データベース接続エラー
   - データベースサーバーが起動しているか確認
   - 接続情報が正しいか確認
   - マイグレーションが最新か確認

2. 認証エラー
   - トークンの有効期限を確認
   - シークレットキーが正しいか確認

3. APIエンドポイントのエラー
   - リクエストパラメータが正しいか確認
   - ログを確認して詳細なエラー情報を取得

## ライセンス

MIT License

## 貢献

プロジェクトへの貢献は大歓迎です。IssueやPull Requestをお待ちしています。

## データベース仕様

### テーブル構造

#### Clubsテーブル
- `id`: 主キー
- `club_id`: ユニークID（文字列）
- `brand`: ブランド名
- `model`: モデル名
- `loft`: ロフト角度（度）
- `shaft`: シャフト名
- `shaft_flex`: シャフトフレックス
- `price`: 価格（円）
- `features`: 特徴（JSON）
- `type`: クラブタイプ
- `specifications`: 仕様（JSON）
- `popularity_score`: 人気スコア
- `created_at`: 作成日時
- `updated_at`: 更新日時
- `is_available`: 在庫状態

### データベース初期化手順

1. データベースの初期化
```bash
python scripts/init_db.py
```

2. サンプルデータの挿入（開発環境用）
```bash
python scripts/insert_sample_data.py
```

3. データベースの状態確認
```bash
python scripts/check_db.py
```

## フロントエンド仕様（2024年4月時点 最新）

### 1. 多言語対応
- サイドバーで「日本語／English」を切り替え可能。
- 主要なUIテキスト（タイトル、説明、フォーム、ボタン、警告・案内文など）は選択言語で表示。

### 2. テーマカラー切替
- サイドバーで3種類のテーマ（ブルー系／グリーン系／レッド系）から選択可能。
- 選択したテーマカラーはボタン・見出し・アクセント等に即時反映。
- カラーボックス付きの視覚的なラジオボタンUIで直感的に選択。

### 3. レスポンシブデザイン
- PC・タブレット・スマホで快適に閲覧できるよう、レイアウトやフォントサイズを自動調整。
- カードやカラムは画面幅に応じて縦並び・横並びを切り替え。

### 4. ダークモード対応
- Streamlitのダークテーマに自動追従。
- 背景・文字色・ボタン色などもダークテーマ用に最適化。

### 5. ダミーデータ切替
- サイドバーで「ダミーデータを使用」チェックボックスをON/OFF可能。
- バックエンドAPIが未稼働でもフロントの動作確認・デモが可能。

### 6. ユーザー入力フォーム
- 基本情報（身長・体重・年齢・性別・ハンディキャップ・ゴルフ歴）
- スイング情報（ヘッドスピード・ボールスピード・打ち出し角度・スイングの悩み・プレー頻度・利き手）
- 予算設定（スライダーで10～50万円、5万円刻み）
- 入力値は多言語対応・0.5刻みの数値入力・選択肢も言語に応じて切替

### 7. 推奨クラブ表示
- 推奨セット総額を上部に大きく表示
- クラブごとにブランド・モデル・価格・カスタマイズ・特徴・購入リンクをカード形式で表示
- 「購入ページへ」ボタンあり
- 本数も明示（最大14本）
- 全文言が多言語対応

### 8. 価格比較表示
- 3つの予算別推奨セット（コスパ重視／新作重視／入門者向け）をカードで横並び表示
- 各カードに特徴・価格帯・説明を記載
- 多言語対応

### 9. フィッティング分析表示
- ユーザープロファイル（身長・体重・年齢・性別・ハンディキャップ）をカードで表示
- スイングデータ（ヘッドスピード・ボールスピード・打ち出し角度）もカードで表示
- スイング改善アドバイス（悩み・推奨鉛テープ位置・イメージ画像）
- 多言語対応

### 10. その他
- すべてのUI・メッセージ・ボタン・警告が日本語／英語で切替可能
- テーマカラー・言語・ダミーデータ設定はセッションごとに保持
- エラー時は言語に応じたメッセージを表示

---

#### 画面イメージや詳細なUI仕様は`app/frontend.py`の実装を参照してください。

## トラッキングの設定

### Google Analytics
1. Google Analyticsのアカウントを作成
2. トラッキングIDを取得
3. `.env`ファイルに`GA_TRACKING_ID`を設定

### Hotjar
1. Hotjarのアカウントを作成
2. サイトIDを取得
3. `.env`ファイルに`HOTJAR_ID`を設定

## トラッキングの確認

1. Google Analytics
   - リアルタイムレポートでアクセスを確認
   - イベントレポートでユーザー行動を確認

2. Hotjar
   - ヒートマップでユーザーの行動を確認
   - セッション記録でユーザーの操作を確認

## 改善のための分析

1. ユーザー行動の分析
   - ページ遷移パターン
   - フォームの完了率
   - エラーの発生箇所

2. パフォーマンスの分析
   - ページの読み込み時間
   - セッション時間
   - 離脱率

3. 改善施策の実施
   - UI/UXの改善
   - パフォーマンスの最適化
   - エラーの修正

# Google Analytics 4 設定

## 設定手順

1. Google Analytics 4のアカウントを作成
2. 新しいプロパティを作成
3. ウェブストリームを設定
   - 開発環境: `http://localhost:8501`
   - 本番環境: `https://your-domain.com`
4. 測定ID（G-XXXXXXXXXX形式）を取得
5. APIシークレットを生成
6. ストリームIDを取得

## 環境変数の設定

以下の環境変数を`.env`ファイルに設定してください：

```env
GA4_MEASUREMENT_ID=G-XXXXXXXXXX
GA4_API_SECRET=your_api_secret_here
GA4_STREAM_ID=your_stream_id_here
```

## トラッキングされるイベント

- ページビュー
- クラブ検索
- クラブ詳細ページの閲覧
- ユーザーアクション 